<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>4D Box Chart Comparator</title>
  <style>
    :root {
      --primary-color: #3498db;
      --secondary-color: #2980b9;
      --text-color: #2c3e50;
      --bg-color: #f5f7fa;
      --card-bg: #ffffff;
      --border-color: #dfe6e9;
      --success-color: #27ae60;
      --warning-color: #f39c12;
      --danger-color: #e74c3c;
      --match-color: #2ecc71;
    }
    
    * {
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: var(--bg-color);
      color: var(--text-color);
      margin: 0;
      padding: 10px;
      line-height: 1.5;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 10px;
    }
    
    h1 {
      font-size: clamp(1.5rem, 5vw, 2rem);
      margin: 0 0 10px 0;
      color: var(--text-color);
      font-weight: 600;
      text-align: center;
    }
    
    .description {
      text-align: center;
      margin-bottom: 15px;
      color: #7f8c8d;
      font-size: 0.9rem;
    }
    
    .chart-container {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      justify-content: center;
      margin-bottom: 15px;
    }
    
    .chart-box {
      background: var(--card-bg);
      border-radius: 8px;
      padding: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      width: 100%;
      max-width: 380px;
    }
    
    .chart-title {
      text-align: center;
      margin-bottom: 12px;
      font-weight: 600;
      color: var(--primary-color);
      font-size: 1.1rem;
    }
    
    .grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 6px;
      margin-bottom: 12px;
    }
    
    input[type="number"] {
      width: 100%;
      aspect-ratio: 1;
      font-size: clamp(16px, 5vw, 20px);
      text-align: center;
      border: 1px solid var(--primary-color);
      border-radius: 6px;
      background: var(--card-bg);
      font-weight: bold;
      transition: all 0.2s;
      -webkit-appearance: none;
      margin: 0;
      padding: 0;
    }
    
    input[type="number"]:focus {
      outline: none;
      border-color: var(--secondary-color);
      box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
    }
    
    .buttons {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 8px;
      margin: 15px 0;
    }
    
    button {
      font-size: clamp(14px, 4vw, 15px);
      padding: 8px 12px;
      background-color: var(--primary-color);
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: all 0.2s;
      font-weight: 600;
      flex: 1 1 auto;
      min-width: 100px;
      max-width: 180px;
    }
    
    button:hover {
      background-color: var(--secondary-color);
    }
    
    button:active {
      transform: translateY(1px);
    }
    
    button:disabled {
      background-color: #95a5a6;
      cursor: not-allowed;
      transform: none;
      opacity: 0.7;
    }
    
    .results-container {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      justify-content: center;
    }
    
    .results-box {
      background: var(--card-bg);
      border-radius: 8px;
      padding: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      width: 100%;
      max-width: 380px;
    }
    
    .category {
      margin-bottom: 12px;
    }
    
    .category h3 {
      margin: 0 0 8px 0;
      color: var(--text-color);
      font-size: clamp(1rem, 4vw, 1.1rem);
      border-bottom: 1px solid var(--primary-color);
      padding-bottom: 4px;
    }
    
    .results {
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
    }
    
    .number {
      background: #f8f9fa;
      border: 1px solid var(--border-color);
      border-radius: 3px;
      padding: 5px 8px;
      font-family: 'Courier New', monospace;
      font-weight: bold;
      font-size: clamp(13px, 3vw, 14px);
      text-align: center;
      transition: all 0.2s;
      flex: 1 0 calc(25% - 8px);
      max-width: calc(25% - 5px);
    }
    
    .number.match {
      background-color: var(--match-color);
      color: white;
      border-color: var(--match-color);
    }
    
    .total-count {
      font-size: clamp(0.9rem, 4vw, 1rem);
      color: var(--success-color);
      margin-bottom: 12px;
      font-weight: 600;
      text-align: center;
    }
    
    .matches-section {
      width: 100%;
      max-width: 800px;
      margin: 15px auto;
      background: var(--card-bg);
      border-radius: 8px;
      padding: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    
    .matches-section h2 {
      color: var(--primary-color);
      text-align: center;
      margin-bottom: 12px;
      font-size: 1.2rem;
    }
    
    /* Input validation styling */
    input:invalid {
      border-color: var(--danger-color);
      animation: shake 0.3s;
    }
    
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-3px); }
      75% { transform: translateX(3px); }
    }
    
    /* Export buttons */
    .export-buttons {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 8px;
      margin: 10px 0;
    }
    
    /* Compact print styles */
    @media print {
      body {
        background: white;
        padding: 0;
        font-size: 12px;
      }
      
      .container {
        max-width: 100%;
        padding: 5px;
      }
      
      .buttons, .export-buttons {
        display: none;
      }
      
      .chart-box, .results-box, .matches-section {
        box-shadow: none;
        border: 1px solid #ddd;
        page-break-inside: avoid;
      }
      
      .number {
        padding: 3px 5px;
        font-size: 11px;
      }
    }
    
    /* Print/export container */
    .export-container {
      background: white;
      padding: 15px;
      max-width: 800px;
      margin: 0 auto;
    }
    
    .export-header {
      text-align: center;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 2px solid var(--primary-color);
    }
    
    .export-header h1 {
      margin: 0;
      color: var(--text-color);
      font-size: 1.5rem;
    }
    
    .export-charts {
      display: flex;
      justify-content: space-around;
      margin-bottom: 15px;
      flex-wrap: wrap;
      gap: 15px;
    }
    
    .export-chart {
      flex: 1;
      min-width: 250px;
    }
    
    .export-chart-title {
      text-align: center;
      font-weight: bold;
      margin-bottom: 10px;
      color: var(--primary-color);
    }
    
    .export-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 5px;
      margin-bottom: 15px;
    }
    
    .export-cell {
      border: 1px solid #ddd;
      text-align: center;
      padding: 8px 0;
      font-weight: bold;
      aspect-ratio: 1;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .export-results {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      margin-bottom: 15px;
    }
    
    .export-result-box {
      flex: 1;
      min-width: 300px;
      border: 1px solid #ddd;
      border-radius: 5px;
      padding: 10px;
    }
    
    .export-category {
      margin-bottom: 10px;
    }
    
    .export-category h3 {
      margin: 0 0 5px 0;
      font-size: 1rem;
      border-bottom: 1px solid #eee;
      padding-bottom: 3px;
    }
    
    .export-numbers {
      display: flex;
      flex-wrap: wrap;
      gap: 3px;
    }
    
    .export-number {
      font-family: 'Courier New', monospace;
      font-size: 11px;
      padding: 2px 5px;
      border: 1px solid #eee;
      border-radius: 2px;
      flex: 0 0 calc(25% - 4px);
    }
    
    .export-number.match {
      background-color: var(--match-color);
      color: white;
      border-color: var(--match-color);
    }
    
    /* Responsive adjustments */
    @media (max-width: 768px) {
      .chart-container, .results-container {
        flex-direction: column;
        align-items: center;
      }
      
      .chart-box, .results-box {
        max-width: 100%;
      }
      
      .number {
        flex: 1 0 calc(33% - 6px);
        max-width: calc(33% - 5px);
        padding: 4px 6px;
        font-size: 13px;
      }
      
      .buttons, .export-buttons {
        gap: 6px;
      }
      
      button {
        min-width: 90px;
        padding: 7px 10px;
      }
    }
    
    @media (max-width: 480px) {
      .grid {
        gap: 4px;
      }
      
      input[type="number"] {
        font-size: 16px;
      }
      
      .number {
        flex: 1 0 calc(50% - 6px);
        max-width: calc(50% - 5px);
      }
      
      .export-number {
        flex: 0 0 calc(33% - 4px);
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>4D Box Chart Comparator</h1>
    <p class="description">Enter numbers in both 4x4 charts to generate and compare 4D combinations</p>
    
    <div class="chart-container">
      <div class="chart-box">
        <h3 class="chart-title">Chart 1</h3>
        <div class="grid" id="inputGrid1"></div>
      </div>
      
      <div class="chart-box">
        <h3 class="chart-title">Chart 2</h3>
        <div class="grid" id="inputGrid2"></div>
      </div>
    </div>
    
    <div class="buttons">
      <button id="generateBtn" onclick="generateCombinations()">Generate & Compare</button>
      <button onclick="resetGrids()">Reset All</button>
    </div>
    
    <div id="output"></div>
    
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>4D Box Chart Comparator</title>
  <style>
    /* [Previous CSS styles remain exactly the same] */
  </style>
</head>
<body>
  <!-- [Previous HTML structure remains exactly the same until the export buttons] -->
  
  <div class="export-buttons" id="exportButtons" style="display: none;">
    <button onclick="exportToText()">Export as Text</button>
    <button onclick="exportToImage()">Export as Image</button>
    <button onclick="exportToTextImage()">Export as Text Image</button>
    <button onclick="window.print()">Print Results</button>
  </div>

  <!-- Hidden export template for text image -->
  <div id="textImageTemplate" style="display: none; position: absolute; left: -9999px; width: 800px; background: white; padding: 20px; font-family: monospace; white-space: pre; line-height: 1.4; font-size: 16px;">
    <div id="textImageContent"></div>
  </div>

  <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
  <script>
    // [Previous JavaScript code remains the same until the export functions]

    // Enhanced text export with better formatting
    function exportToText() {
      let textContent = `╔════════════════════════════════════════════╗
║         4D BOX CHART COMPARISON RESULTS       ║
╟──────────────────────────────────────────────╢
║ Generated: ${new Date().toLocaleString().padEnd(30)}║
╚════════════════════════════════════════════╝\n\n`;

      // Add chart 1 data
      textContent += `╔═══════════════╗
║   CHART 1    ║
╟───────────────╢
${formatChartAsText('inputGrid1')}
╟───────────────╢
${formatCombinationsAsText(currentCategories.chart1, "COMBINATIONS")}
╚═══════════════╝\n\n`;

      // Add chart 2 data
      textContent += `╔═══════════════╗
║   CHART 2    ║
╟───────────────╢
${formatChartAsText('inputGrid2')}
╟───────────────╢
${formatCombinationsAsText(currentCategories.chart2, "COMBINATIONS")}
╚═══════════════╝\n\n`;

      // Add matches
      textContent += `╔══════════════════════╗
║ MATCHING COMBINATIONS ║
╟──────────────────────╢
${formatCombinationsAsText(currentCategories.matches, "MATCHES", true)}
╚══════════════════════╝`;

      // Create download
      const blob = new Blob([textContent], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = '4d_comparison_results.txt';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    function formatChartAsText(gridId) {
      const inputs = document.querySelectorAll(`#${gridId} input`);
      let text = '';
      
      for (let i = 0; i < 16; i++) {
        text += inputs[i].value + ' ';
        if ((i + 1) % 4 === 0) {
          text = text.trim();
          text += '\n';
        }
      }
      
      return text;
    }

    function formatCombinationsAsText(categories, title, highlightMatches = false) {
      let text = '';
      const maxLineLength = 60;
      
      for (const [category, numbers] of Object.entries(categories)) {
        if (numbers.length === 0) continue;
        
        const categoryTitle = `${category.toUpperCase()}-WAY (${numbers.length})`;
        text += `┌${'─'.repeat(categoryTitle.length + 2)}┐\n`;
        text += `│ ${categoryTitle} │\n`;
        text += `└${'─'.repeat(categoryTitle.length + 2)}┘\n`;
        
        let line = '';
        numbers.forEach((num, index) => {
          const numStr = highlightMatches && currentCategories.matches[category]?.includes(num) 
            ? `[${num}]` : num;
          
          if (line.length + numStr.length + 2 > maxLineLength) {
            text += line.trim() + '\n';
            line = '';
          }
          line += numStr + ' ';
        });
        
        if (line.trim().length > 0) {
          text += line.trim() + '\n';
        }
        
        text += '\n';
      }
      
      return text;
    }

    // Export as text formatted image
    function exportToTextImage() {
      // Prepare the text content
      let textContent = `4D BOX CHART COMPARISON RESULTS\n`;
      textContent += `Generated: ${new Date().toLocaleString()}\n\n`;
      
      textContent += `=== CHART 1 ===\n`;
      textContent += formatChartAsText('inputGrid1') + '\n';
      textContent += formatCombinationsAsText(currentCategories.chart1, "COMBINATIONS") + '\n';
      
      textContent += `=== CHART 2 ===\n`;
      textContent += formatChartAsText('inputGrid2') + '\n';
      textContent += formatCombinationsAsText(currentCategories.chart2, "COMBINATIONS") + '\n';
      
      textContent += `=== MATCHING COMBINATIONS ===\n`;
      textContent += formatCombinationsAsText(currentCategories.matches, "MATCHES", true);

      // Create the text image template
      const template = document.getElementById('textImageTemplate');
      const content = document.getElementById('textImageContent');
      content.textContent = textContent;
      template.style.display = 'block';
      
      // Capture as image with higher quality
      html2canvas(template, {
        scale: 3, // Higher scale for better quality
        logging: false,
        backgroundColor: '#ffffff',
        windowWidth: template.scrollWidth,
        windowHeight: template.scrollHeight
      }).then(canvas => {
        // Hide the template again
        template.style.display = 'none';
        
        // Create download
        const link = document.createElement('a');
        link.download = '4d_comparison_results.png';
        link.href = canvas.toDataURL('image/png');
        link.click();
      });
    }

    // [Rest of the JavaScript code remains the same]
  </script>
</body>
</html>

    
    function populateExportGrid(sourceId, targetId, container) {
      const sourceInputs = document.querySelectorAll(`#${sourceId} input`);
      const targetGrid = container.querySelector(`#${targetId}`);
      targetGrid.innerHTML = '';
      
      for (let i = 0; i < 16; i++) {
        const cell = document.createElement('div');
        cell.className = 'export-cell';
        cell.textContent = sourceInputs[i].value;
        targetGrid.appendChild(cell);
      }
    }
    
    function populateExportResults(targetId, categories, container, allMatches = false) {
      const targetElement = container.querySelector(`#${targetId}`);
      targetElement.innerHTML = '';
      
      for (const [category, numbers] of Object.entries(categories)) {
        if (numbers.length === 0) continue;
        
        const categoryDiv = document.createElement('div');
        categoryDiv.className = 'export-category';
        
        const title = document.createElement('h3');
        title.textContent = `${category} (${numbers.length})`;
        categoryDiv.appendChild(title);
        
        const numbersDiv = document.createElement('div');
        numbersDiv.className = 'export-numbers';
        
        numbers.forEach(num => {
          const numSpan = document.createElement('span');
          numSpan.className = 'export-number';
          numSpan.textContent = num;
          
          if (allMatches || currentCategories.matches[category].includes(num)) {
            numSpan.classList.add('match');
          }
          
          numbersDiv.appendChild(numSpan);
        });
        
        categoryDiv.appendChild(numbersDiv);
        targetElement.appendChild(categoryDiv);
      }
    }

    // Initialize on load
    window.onload = function() {
      initGrids();
      validateInputs();
    };
  </script>
</body>
</html>
